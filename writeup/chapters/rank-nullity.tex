\subsection{The rank-nullity theorem for operators}
\newcommand{\anihv}{\ensuremath{V_\perp}}

\begin{definition}
    Let $(X, \norm{}{\cdot})$ be a normed \thefield\ vector space and $V \subset X'$.
    Then we define the annihilator of $V$ in $X$ as
    \[ \anihv = \braces{x \in X \mid \forall x' \in V: x'(x) = 0} \]
    \note{
        The annihilator is the set of linear, bounded functionals
        that "see" exactly the opposite of $V$
        and are "blind" to $V$.
    }
\end{definition}

\noindent To prove properties about this set, we need another corollary of the theorem of Hahn-Banach:

\begin{revision}\label{revision:hahn-banach-closed-subspace}
    Let $(X, \norm{}{\cdot})$ be a normed \thefield\ vector space,
    $U \subset X$ a closed subspace and $x \in X \setminus U$.
    Then we have
    \[ \exists x' \in X': x'|_U = 0 \logicaland x'(x) \neq 0 \]
\end{revision}
\begin{proof}
    Let $Y = X / U$ be the (canonical) quotient space.
    Then $Y$ is a normed \thefield\ vector space. (todo: why?)
    Set $y = x \in Y$.
    We can apply the theorem of Hahn-Banach\ \ref{theorem:hahn-banach-op-norm}
    to obtain $y' \in Y'$ with $y'(y) \neq 0$ and $y'|_U = 0$.
\end{proof}

\begin{theorem}
    Let $(X, \norm{}{\cdot})$ be a normed \thefield\ vector space and $V \subset X'$.
    Then we have
    \[ \anihv \subset X \text{ is a closed linear subspace} \]
\end{theorem}
\begin{proof}
    We have
    \[ \anihv = \bigcap_{x' \in V}{\inv{(x')}(0)} \]
    As an intersection of closed sets, \anihv must be closed.
\end{proof}

\newcommand{\kerdualperp}{\ensuremath{(\ker T')_\perp}\xspace}

\begin{theorem}\label{theorem:rank-nullity-generalized}
    Let $T \in \contoperators{X}{Y}$ be a bounded, linear operator.
    Then we have \[ \overline{\im T} = \kerdualperp \]
    \note{
        In linear algebra lectures this is proven for finite-dimensional vector spaces
        (see Satz 6.1.5\ \cite{Wer18})
    }
\end{theorem}
\begin{proof}
    \leftrightinclusion
    Let $Tx \in \im T$ with $x \in X$ and $y' \in \ker T'$. \\
    We first prove $Tx \in \kerdualperp$:
    \begin{align*}
        y'(Tx) &= (y' \chain T)(x)  \explainstep{associativity and use \chain\ notation} \\
        &= (T' y')(x)               \explainstep{apply adjoint op. definition} \\
        &= 0(x) = 0                 \explainstep{apply $y' \in \ker T'$}
    \end{align*}
    Since this holds for all choices of $Tx$ we get \[ \im T \subset \kerdualperp \]
    Since \kerdualperp is closed, we also get \[ \overline{\im T} \subset \kerdualperp \]

    \noindent \rightleftinclusion
    We can prove the contraposition
    \[ \parens{Y \setminus \overline{\im T}} \subset \parens{Y \setminus \kerdualperp} \]
    Set $U = \overline{\im T}$ and let $y \in Y \setminus U$.
    We know $U$ that a closed linear subspace.
    The corollary of the theorem of Hahn-Banach\ \ref{revision:hahn-banach-closed-subspace} tells us that
    \[ \exists y' \in Y' : y'|_U = 0 \logicaland y'(y) \neq 0 \]
    Since $\ker T' \subset Y'$ 
    and \[\forall y' \in \ker T' : y'(y) \neq 0 \]
    we get \[ y \in Y \setminus \kerdualperp \]
\end{proof}

\begin{corollary}\label{corollary:operator-solutions}
    Let $T \in \contoperators{X}{Y}$ be a linear, continuous operator with $\im T$ closed. Then we have 
    \[ y \in \im T \text{ if and only if } \forall y' \in Y': T'y' = 0 \implies y'(y) = 0 \]
\end{corollary}
\begin{proof}
    We have
    \begin{align*}
        y \in \im T 
        &= \overline{\im T}                                     \explainstep{$\im T$ is closed} \\
        &= \kerdualperp                                         \explainstep{apply theorem \ref{theorem:rank-nullity-generalized}} \\
        \iff &\forall y' \in \ker T' : y'(y) = 0                \explainstep{apply def. of annihilator} \\
        \iff &\forall y' \in Y': T'y' = 0 \implies y'(y) = 0    \explainstep{write in equivalent way}
    \end{align*}
\end{proof}

\begin{example}[Left Shift]
    Consider the left shift operator $T: \lp \to \lp$ from Example \ref{example:shift-operator}. 
    As shown previously, its adjoint $T': \lpconj \to \lpconj$ is the right shift operator: 
    \[ T'(s_1, s_2, \dots) = (0, s_1, s_2, \dots) \]
    
    To apply Theorem \ref{theorem:rank-nullity-generalized}, we first find $\ker T'$. 
    If $T's = 0$, then $(0, s_1, s_2, \dots) = (0, 0, 0, \dots)$, which implies $s = 0$. 
    Thus, $\ker T' = \{0\}$.
    
    The theorem states that $\overline{\im T} = (\ker T')_\perp = \{0\}_\perp = \lp$. 
    This is consistent with the fact that the left shift is surjective ($\im T = \lp$), so its range is already the entire space and is closed.
\end{example}

\begin{example}[Right Shift]
    Now consider the right shift operator $T: \lp \to \lp, T(x_1, x_2, \dots) = (0, x_1, x_2, \dots)$.
    Its image is the closed subspace of sequences with a vanishing first term:
    \[ \im T = \{ y \in \lp \mid y_1 = 0 \} \]
    
    The adjoint $T': \lpconj \to \lpconj$ is the left shift operator, $T'(s_1, s_2, s_3, \dots) = (s_2, s_3, \dots)$.
    An element $s \in \lpconj$ is in $\ker T'$ if and only if $s_2 = s_3 = \dots = 0$. 
    Thus, the kernel consists of sequences where only the first term may be non-zero:
    \[ \ker T' = \{ (s_1, 0, 0, \dots) \mid s_1 \in \thefield \} = \text{span}\{e_1'\} \]
    
    According to Corollary \ref{corollary:operator-solutions}, a vector $y \in \lp$ lies in $\im T$ if and only if it is annihilated by every functional in $\ker T'$. 
    For any $s \in \ker T'$, the condition $s(y) = 0$ becomes:
    \[ \sum_{k=1}^\infty y_k s_k = y_1 s_1 + y_2 \cdot 0 + y_3 \cdot 0 + \dots = y_1 s_1 = 0 \]
    Since this must hold for all $s_1 \in \thefield$, we must have $y_1 = 0$. 
    This perfectly matches our initial description of $\im T$, verifying the theorem.
\end{example}
